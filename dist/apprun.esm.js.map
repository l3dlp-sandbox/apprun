{"version":3,"file":"apprun.esm.js","sources":["../esm/app.js","../esm/directive.js","../esm/vdom-my.js","../esm/web-component.js","../esm/decorator.js","../esm/component.js","../esm/router.js","../esm/apprun.js"],"sourcesContent":["/**\n * Core AppRun application class and singleton instance\n *\n * This file provides:\n * 1. App class - The core event system implementation with pub/sub capabilities\n *    - on(): Subscribe to events\n *    - off(): Unsubscribe from events\n *    - run(): Publish events synchronously\n *    - runAsync(): Publish events asynchronously\n *    - query(): Alias for runAsync\n *\n * 2. Default app singleton - Global event bus instance\n *    - Created once and reused across the application\n *    - Stored in global scope (window/global)\n *    - Version tracked to prevent duplicate instances\n *\n * Usage:\n * ```ts\n * // Subscribe to events\n * app.on('event-name', (state, ...args) => {\n *   // Handle event\n * });\n *\n * // Publish events\n * app.run('event-name', ...args);\n * ```\n */\nexport class App {\n    constructor() {\n        this._events = {};\n    }\n    on(name, fn, options = {}) {\n        this._events[name] = this._events[name] || [];\n        this._events[name].push({ fn, options });\n    }\n    off(name, fn) {\n        const subscribers = this._events[name] || [];\n        this._events[name] = subscribers.filter((sub) => sub.fn !== fn);\n    }\n    find(name) {\n        return this._events[name];\n    }\n    run(name, ...args) {\n        const subscribers = this.getSubscribers(name, this._events);\n        console.assert(subscribers && subscribers.length > 0, 'No subscriber for event: ' + name);\n        subscribers.forEach((sub) => {\n            const { fn, options } = sub;\n            if (options.delay) {\n                this.delay(name, fn, args, options);\n            }\n            else {\n                Object.keys(options).length > 0 ? fn.apply(this, [...args, options]) : fn.apply(this, args);\n            }\n            return !sub.options.once;\n        });\n        return subscribers.length;\n    }\n    once(name, fn, options = {}) {\n        this.on(name, fn, Object.assign(Object.assign({}, options), { once: true }));\n    }\n    delay(name, fn, args, options) {\n        if (options._t)\n            clearTimeout(options._t);\n        options._t = setTimeout(() => {\n            clearTimeout(options._t);\n            Object.keys(options).length > 0 ? fn.apply(this, [...args, options]) : fn.apply(this, args);\n        }, options.delay);\n    }\n    runAsync(name, ...args) {\n        const subscribers = this.getSubscribers(name, this._events);\n        console.assert(subscribers && subscribers.length > 0, 'No subscriber for event: ' + name);\n        const promises = subscribers.map(sub => {\n            const { fn, options } = sub;\n            return Object.keys(options).length > 0 ? fn.apply(this, [...args, options]) : fn.apply(this, args);\n        });\n        return Promise.all(promises);\n    }\n    query(name, ...args) {\n        return this.runAsync(name, ...args);\n    }\n    getSubscribers(name, events) {\n        const subscribers = events[name] || [];\n        // Update the list of subscribers by pulling out those which will run once.\n        // We must do this update prior to running any of the events in case they\n        // cause additional events to be turned off or on.\n        events[name] = subscribers.filter((sub) => {\n            return !sub.options.once;\n        });\n        Object.keys(events).filter(evt => evt.endsWith('*') && name.startsWith(evt.replace('*', '')))\n            .sort((a, b) => b.length - a.length)\n            .forEach(evt => subscribers.push(...events[evt].map(sub => (Object.assign(Object.assign({}, sub), { options: Object.assign(Object.assign({}, sub.options), { event: name }) })))));\n        return subscribers;\n    }\n}\nconst AppRunVersions = 'AppRun-3.3.11';\nlet _app;\nconst root = (typeof window !== 'undefined' ? window :\n    typeof global !== 'undefined' ? global :\n        typeof self !== 'undefined' ? self : {});\nif (root.app && root._AppRunVersions) {\n    _app = root.app;\n}\nelse {\n    _app = new App();\n    root.app = _app;\n    root._AppRunVersions = AppRunVersions;\n}\nexport default _app;\n//# sourceMappingURL=app.js.map","/**\n * Component Directives Implementation\n *\n * This file provides built-in directives for components:\n * 1. Event Binding\n *    - $on: Bind DOM events to component events\n *    - Supports event delegation and parameters\n *    - Handles function, string, and array event handlers\n *\n * 2. Two-way Data Binding\n *    - $bind: Sync form elements with component state\n *    - Handles input types: text, checkbox, radio, select\n *    - Automatic value type conversion\n *    - Support for complex property paths\n *\n * 3. Custom Directives\n *    - Extensible directive system\n *    - Processes virtual DOM during rendering\n *    - Supports custom attribute directives\n *\n * Usage:\n * ```tsx\n * // Event binding\n * <button $onclick=\"event-name\">Click</button>\n * <input $oninput={e => setState(e.target.value)} />\n *\n * // Two-way binding\n * <input $bind=\"state.property\" />\n * <select $bind=\"selected\">...</select>\n * ```\n */\nimport app from './app';\nconst getStateValue = (component, name) => {\n    return (name ? component['state'][name] : component['state']) || '';\n};\nconst setStateValue = (component, name, value) => {\n    if (name) {\n        const state = component['state'] || {};\n        state[name] = value;\n        component.setState(state);\n    }\n    else {\n        component.setState(value);\n    }\n};\nconst apply_directive = (key, props, tag, component) => {\n    if (key.startsWith('$on')) {\n        const event = props[key];\n        key = key.substring(1);\n        if (typeof event === 'boolean') {\n            props[key] = e => component.run ? component.run(key, e) : app.run(key, e);\n        }\n        else if (typeof event === 'string') {\n            props[key] = e => component.run ? component.run(event, e) : app.run(event, e);\n        }\n        else if (typeof event === 'function') {\n            props[key] = e => component.setState(event(component.state, e));\n        }\n        else if (Array.isArray(event)) {\n            const [handler, ...p] = event;\n            if (typeof handler === 'string') {\n                props[key] = e => component.run ? component.run(handler, ...p, e) : app.run(handler, ...p, e);\n            }\n            else if (typeof handler === 'function') {\n                props[key] = e => component.setState(handler(component.state, ...p, e));\n            }\n        }\n    }\n    else if (key === '$bind') {\n        const type = props['type'] || 'text';\n        const name = typeof props[key] === 'string' ? props[key] : props['name'];\n        if (tag === 'input') {\n            switch (type) {\n                case 'checkbox':\n                    props['checked'] = getStateValue(component, name);\n                    props['onclick'] = e => setStateValue(component, name || e.target.name, e.target.checked);\n                    break;\n                case 'radio':\n                    props['checked'] = getStateValue(component, name) === props['value'];\n                    props['onclick'] = e => setStateValue(component, name || e.target.name, e.target.value);\n                    break;\n                case 'number':\n                case 'range':\n                    props['value'] = getStateValue(component, name);\n                    props['oninput'] = e => setStateValue(component, name || e.target.name, Number(e.target.value));\n                    break;\n                default:\n                    props['value'] = getStateValue(component, name);\n                    props['oninput'] = e => setStateValue(component, name || e.target.name, e.target.value);\n            }\n        }\n        else if (tag === 'select') {\n            props['value'] = getStateValue(component, name);\n            props['onchange'] = e => {\n                if (!e.target.multiple) { // multiple selection use $bind on option\n                    setStateValue(component, name || e.target.name, e.target.value);\n                }\n            };\n        }\n        else if (tag === 'option') {\n            props['selected'] = getStateValue(component, name);\n            props['onclick'] = e => setStateValue(component, name || e.target.name, e.target.selected);\n        }\n        else if (tag === 'textarea') {\n            props['innerHTML'] = getStateValue(component, name);\n            props['oninput'] = e => setStateValue(component, name || e.target.name, e.target.value);\n        }\n    }\n    else {\n        app.run('$', { key, tag, props, component });\n    }\n};\nconst directive = (vdom, component) => {\n    if (Array.isArray(vdom)) {\n        return vdom.map(element => directive(element, component));\n    }\n    else {\n        let { type, tag, props, children } = vdom;\n        tag = tag || type;\n        children = children || (props === null || props === void 0 ? void 0 : props.children);\n        if (props)\n            Object.keys(props).forEach(key => {\n                if (key.startsWith('$')) {\n                    apply_directive(key, props, tag, component);\n                    delete props[key];\n                }\n            });\n        if (children)\n            directive(children, component);\n        return vdom;\n    }\n};\nexport default directive;\n//# sourceMappingURL=directive.js.map","import directive from './directive';\nexport function Fragment(props, ...children) {\n    return collect(children);\n}\nconst ATTR_PROPS = '_props';\nfunction collect(children) {\n    const ch = [];\n    const push = (c) => {\n        if (c !== null && c !== undefined && c !== '' && c !== false) {\n            ch.push((typeof c === 'function' || typeof c === 'object') ? c : `${c}`);\n        }\n    };\n    children && children.forEach(c => {\n        if (Array.isArray(c)) {\n            c.forEach(i => push(i));\n        }\n        else {\n            push(c);\n        }\n    });\n    return ch;\n}\nexport function createElement(tag, props, ...children) {\n    const ch = collect(children);\n    if (typeof tag === 'string')\n        return { tag, props, children: ch };\n    else if (Array.isArray(tag))\n        return tag; // JSX fragments - babel\n    else if (tag === undefined && children)\n        return ch; // JSX fragments - typescript\n    else if (Object.getPrototypeOf(tag).__isAppRunComponent)\n        return { tag, props, children: ch }; // createComponent(tag, { ...props, children });\n    else if (typeof tag === 'function')\n        return tag(props, ch);\n    else\n        throw new Error(`Unknown tag in vdom ${tag}`);\n}\n;\nconst keyCache = new WeakMap();\nexport const updateElement = (element, nodes, component = {}) => {\n    // tslint:disable-next-line\n    if (nodes == null || nodes === false)\n        return;\n    const el = (typeof element === 'string' && element) ?\n        document.getElementById(element) || document.querySelector(element) : element;\n    nodes = directive(nodes, component);\n    render(el, nodes, component);\n};\nfunction render(element, nodes, parent = {}) {\n    // tslint:disable-next-line\n    if (nodes == null || nodes === false)\n        return;\n    nodes = createComponent(nodes, parent);\n    if (!element)\n        return;\n    const isSvg = element.nodeName === \"SVG\";\n    if (Array.isArray(nodes)) {\n        updateChildren(element, nodes, isSvg);\n    }\n    else {\n        updateChildren(element, [nodes], isSvg);\n    }\n}\nfunction same(el, node) {\n    // if (!el || !node) return false;\n    const key1 = el.nodeName;\n    const key2 = `${node.tag || ''}`;\n    return key1.toUpperCase() === key2.toUpperCase();\n}\nfunction update(element, node, isSvg) {\n    if (node['_op'] === 3)\n        return;\n    // console.assert(!!element);\n    isSvg = isSvg || node.tag === \"svg\";\n    if (!same(element, node)) {\n        element.parentNode.replaceChild(create(node, isSvg), element);\n        return;\n    }\n    !(node['_op'] & 2) && updateChildren(element, node.children, isSvg);\n    !(node['_op'] & 1) && updateProps(element, node.props, isSvg);\n}\nfunction updateChildren(element, children, isSvg) {\n    var _a, _b;\n    const old_len = ((_a = element.childNodes) === null || _a === void 0 ? void 0 : _a.length) || 0;\n    const new_len = (children === null || children === void 0 ? void 0 : children.length) || 0;\n    const len = Math.min(old_len, new_len);\n    for (let i = 0; i < len; i++) {\n        const child = children[i];\n        if (child['_op'] === 3)\n            continue;\n        const el = element.childNodes[i];\n        if (typeof child === 'string') {\n            if (el.textContent !== child) {\n                if (el.nodeType === 3) {\n                    el.nodeValue = child;\n                }\n                else {\n                    element.replaceChild(createText(child), el);\n                }\n            }\n        }\n        else if (child instanceof HTMLElement || child instanceof SVGElement) {\n            element.insertBefore(child, el);\n        }\n        else {\n            const key = child.props && child.props['key'];\n            if (key) {\n                if (el.key === key) {\n                    update(element.childNodes[i], child, isSvg);\n                }\n                else {\n                    // console.log(el.key, key);\n                    const old = keyCache[key];\n                    if (old) {\n                        const temp = old.nextSibling;\n                        element.insertBefore(old, el);\n                        temp ? element.insertBefore(el, temp) : element.appendChild(el);\n                        update(element.childNodes[i], child, isSvg);\n                    }\n                    else {\n                        element.replaceChild(create(child, isSvg), el);\n                    }\n                }\n            }\n            else {\n                update(element.childNodes[i], child, isSvg);\n            }\n        }\n    }\n    let n = ((_b = element.childNodes) === null || _b === void 0 ? void 0 : _b.length) || 0;\n    while (n > len) {\n        element.removeChild(element.lastChild);\n        n--;\n    }\n    if (new_len > len) {\n        const d = document.createDocumentFragment();\n        for (let i = len; i < children.length; i++) {\n            d.appendChild(create(children[i], isSvg));\n        }\n        element.appendChild(d);\n    }\n}\nexport const safeHTML = (html) => {\n    const div = document.createElement('section');\n    div.insertAdjacentHTML('afterbegin', html);\n    return Array.from(div.children);\n};\nfunction createText(node) {\n    if ((node === null || node === void 0 ? void 0 : node.indexOf('_html:')) === 0) { // ?\n        const div = document.createElement('div');\n        div.insertAdjacentHTML('afterbegin', node.substring(6));\n        return div;\n    }\n    else {\n        return document.createTextNode(node !== null && node !== void 0 ? node : '');\n    }\n}\nfunction create(node, isSvg) {\n    // console.assert(node !== null && node !== undefined);\n    if ((node instanceof HTMLElement) || (node instanceof SVGElement))\n        return node;\n    if (typeof node === \"string\")\n        return createText(node);\n    if (!node.tag || (typeof node.tag === 'function'))\n        return createText(JSON.stringify(node));\n    isSvg = isSvg || node.tag === \"svg\";\n    const element = isSvg\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.tag)\n        : document.createElement(node.tag);\n    updateProps(element, node.props, isSvg);\n    if (node.children)\n        node.children.forEach(child => element.appendChild(create(child, isSvg)));\n    return element;\n}\nfunction mergeProps(oldProps, newProps) {\n    newProps['class'] = newProps['class'] || newProps['className'];\n    delete newProps['className'];\n    const props = {};\n    if (oldProps)\n        Object.keys(oldProps).forEach(p => props[p] = null);\n    if (newProps)\n        Object.keys(newProps).forEach(p => props[p] = newProps[p]);\n    return props;\n}\nexport function updateProps(element, props, isSvg) {\n    // console.assert(!!element);\n    const cached = element[ATTR_PROPS] || {};\n    props = mergeProps(cached, props || {});\n    element[ATTR_PROPS] = props;\n    for (const name in props) {\n        const value = props[name];\n        // if (cached[name] === value) continue;\n        // console.log('updateProps', name, value);\n        if (name.startsWith('data-')) {\n            const dname = name.substring(5);\n            const cname = dname.replace(/-(\\w)/g, (match) => match[1].toUpperCase());\n            if (element.dataset[cname] !== value) {\n                if (value || value === \"\")\n                    element.dataset[cname] = value;\n                else\n                    delete element.dataset[cname];\n            }\n        }\n        else if (name === 'style') {\n            if (element.style.cssText)\n                element.style.cssText = '';\n            if (typeof value === 'string')\n                element.style.cssText = value;\n            else {\n                for (const s in value) {\n                    if (element.style[s] !== value[s])\n                        element.style[s] = value[s];\n                }\n            }\n        }\n        else if (name.startsWith('xlink')) {\n            const xname = name.replace('xlink', '').toLowerCase();\n            if (value == null || value === false) {\n                element.removeAttributeNS('http://www.w3.org/1999/xlink', xname);\n            }\n            else {\n                element.setAttributeNS('http://www.w3.org/1999/xlink', xname, value);\n            }\n        }\n        else if (name.startsWith('on')) {\n            if (!value || typeof value === 'function') {\n                element[name] = value;\n            }\n            else if (typeof value === 'string') {\n                if (value)\n                    element.setAttribute(name, value);\n                else\n                    element.removeAttribute(name);\n            }\n        }\n        else if (/^id$|^class$|^list$|^readonly$|^contenteditable$|^role|-|^for$/g.test(name) || isSvg) {\n            if (element.getAttribute(name) !== value) {\n                if (value)\n                    element.setAttribute(name, value);\n                else\n                    element.removeAttribute(name);\n            }\n        }\n        else if (element[name] !== value) {\n            element[name] = value;\n        }\n        if (name === 'key' && value)\n            keyCache[value] = element;\n    }\n    if (props && typeof props['ref'] === 'function') {\n        window.requestAnimationFrame(() => props['ref'](element));\n    }\n}\nfunction render_component(node, parent, idx) {\n    const { tag, props, children } = node;\n    let key = `_${idx}`;\n    let id = props && props['id'];\n    if (!id)\n        id = `_${idx}${Date.now()}`;\n    else\n        key = id;\n    let asTag = 'section';\n    if (props && props['as']) {\n        asTag = props['as'];\n        delete props['as'];\n    }\n    if (!parent.__componentCache)\n        parent.__componentCache = {};\n    let component = parent.__componentCache[key];\n    if (!component || !(component instanceof tag) || !component.element) {\n        const element = document.createElement(asTag);\n        component = parent.__componentCache[key] = new tag(Object.assign(Object.assign({}, props), { children })).mount(element, { render: true });\n    }\n    else {\n        component.renderState(component.state);\n    }\n    if (component.mounted) {\n        const new_state = component.mounted(props, children, component.state);\n        (typeof new_state !== 'undefined') && component.setState(new_state);\n    }\n    updateProps(component.element, props, false);\n    return component.element;\n}\nfunction createComponent(node, parent, idx = 0) {\n    var _a;\n    if (typeof node === 'string')\n        return node;\n    if (Array.isArray(node))\n        return node.map(child => createComponent(child, parent, idx++));\n    let vdom = node;\n    if (node && typeof node.tag === 'function' && Object.getPrototypeOf(node.tag).__isAppRunComponent) {\n        vdom = render_component(node, parent, idx);\n    }\n    if (vdom && Array.isArray(vdom.children)) {\n        const new_parent = (_a = vdom.props) === null || _a === void 0 ? void 0 : _a._component;\n        if (new_parent) {\n            let i = 0;\n            vdom.children = vdom.children.map(child => createComponent(child, new_parent, i++));\n        }\n        else {\n            vdom.children = vdom.children.map(child => createComponent(child, parent, idx++));\n        }\n    }\n    return vdom;\n}\n//# sourceMappingURL=vdom-my.js.map","/**\n * Web Components Integration\n *\n * This file enables using AppRun components as Web Components:\n * 1. Custom Element Creation\n *    - Converts AppRun components to custom elements\n *    - Handles lifecycle (connected, disconnected, etc)\n *    - Manages shadow DOM and light DOM rendering\n *\n * 2. Property/Attribute Sync\n *    - Observes attribute changes\n *    - Updates component state automatically\n *    - Handles camelCase/kebab-case conversion\n *    - Supports complex property types\n *\n * 3. Event Handling\n *    - Proxies events between component and element\n *    - Supports both global and local events\n *    - Maintains proper event bubbling\n *\n * Usage:\n * ```ts\n * // Register web component\n * @customElement('my-element')\n * class MyComponent extends Component {\n *   // Regular AppRun component code\n * }\n *\n * // Use in HTML\n * <my-element name=\"value\"></my-element>\n * ```\n */\nexport const customElement = (componentClass, options = {}) => class CustomElement extends HTMLElement {\n    constructor() {\n        super();\n    }\n    get component() { return this._component; }\n    get state() { return this._component.state; }\n    static get observedAttributes() {\n        // attributes need to be set to lowercase in order to get observed\n        return (options.observedAttributes || []).map(attr => attr.toLowerCase());\n    }\n    connectedCallback() {\n        if (this.isConnected && !this._component) {\n            const opts = options || {};\n            this._shadowRoot = opts.shadow ? this.attachShadow({ mode: 'open' }) : this;\n            const observedAttributes = (opts.observedAttributes || []);\n            const attrMap = observedAttributes.reduce((map, name) => {\n                const lc = name.toLowerCase();\n                if (lc !== name) {\n                    map[lc] = name;\n                }\n                return map;\n            }, {});\n            this._attrMap = (name) => attrMap[name] || name;\n            const props = {};\n            Array.from(this.attributes).forEach(item => props[this._attrMap(item.name)] = item.value);\n            // add getters/ setters to allow observation on observedAttributes\n            observedAttributes.forEach(name => {\n                if (this[name] !== undefined)\n                    props[name] = this[name];\n                Object.defineProperty(this, name, {\n                    get() {\n                        return props[name];\n                    },\n                    set(value) {\n                        // trigger change event\n                        this.attributeChangedCallback(name, props[name], value);\n                    },\n                    configurable: true,\n                    enumerable: true\n                });\n            });\n            requestAnimationFrame(() => {\n                const children = this.children ? Array.from(this.children) : [];\n                // children.forEach(el => el.parentElement.removeChild(el));\n                this._component = new componentClass(Object.assign(Object.assign({}, props), { children })).mount(this._shadowRoot, opts);\n                // attach props to component\n                this._component._props = props;\n                // expose dispatchEvent\n                this._component.dispatchEvent = this.dispatchEvent.bind(this);\n                if (this._component.mounted) {\n                    const new_state = this._component.mounted(props, children, this._component.state);\n                    if (typeof new_state !== 'undefined')\n                        this._component.state = new_state;\n                }\n                this.on = this._component.on.bind(this._component);\n                this.run = this._component.run.bind(this._component);\n                if (!(opts.render === false))\n                    this._component.run('.');\n            });\n        }\n    }\n    disconnectedCallback() {\n        var _a, _b, _c, _d;\n        (_b = (_a = this._component) === null || _a === void 0 ? void 0 : _a.unload) === null || _b === void 0 ? void 0 : _b.call(_a);\n        (_d = (_c = this._component) === null || _c === void 0 ? void 0 : _c.unmount) === null || _d === void 0 ? void 0 : _d.call(_c);\n        this._component = null;\n    }\n    attributeChangedCallback(name, oldValue, value) {\n        if (this._component) {\n            // camelCase attributes arrive only in lowercase\n            const mappedName = this._attrMap(name);\n            // store the new property/ attribute\n            this._component._props[mappedName] = value;\n            this._component.run('attributeChanged', mappedName, oldValue, value);\n            if (value !== oldValue && !(options.render === false)) {\n                window.requestAnimationFrame(() => {\n                    // re-render state with new combined props on next animation frame\n                    this._component.run('.');\n                });\n            }\n        }\n    }\n};\nexport default (name, componentClass, options) => {\n    (typeof customElements !== 'undefined') && customElements.define(name, customElement(componentClass, options));\n};\n//# sourceMappingURL=web-component.js.map","import webComponent from './web-component';\n/**\n * TypeScript Decorators for AppRun Components\n *\n * This file provides decorators that enable:\n * 1. Event Handler Registration\n *    - @on(): Subscribe to events with options\n *    - @update(): Define state updates with metadata\n *\n * 2. Web Component Integration\n *    - @customElement(): Register as custom element with options\n *    - Handles shadow DOM and attribute observation\n *\n * 3. Metadata Management\n *    - Custom Reflect implementation for decorator metadata\n *    - Stores event handler and update metadata\n *    - Supports runtime reflection for dynamic behavior\n *\n * Usage:\n * ```ts\n * @customElement('my-element')\n * class MyComponent extends Component {\n *   @on('event')\n *   handler(state, ...args) {\n *     // Handle event\n *   }\n *\n *   @update('event')\n *   updater(state, ...args) {\n *     // Update state\n *   }\n * }\n * ```\n */\n// tslint:disable:no-invalid-this\nexport const Reflect = {\n    meta: new WeakMap(),\n    defineMetadata(metadataKey, metadataValue, target) {\n        if (!this.meta.has(target))\n            this.meta.set(target, {});\n        this.meta.get(target)[metadataKey] = metadataValue;\n    },\n    getMetadataKeys(target) {\n        target = Object.getPrototypeOf(target);\n        return this.meta.get(target) ? Object.keys(this.meta.get(target)) : [];\n    },\n    getMetadata(metadataKey, target) {\n        target = Object.getPrototypeOf(target);\n        return this.meta.get(target) ? this.meta.get(target)[metadataKey] : null;\n    }\n};\nexport function update(events, options = {}) {\n    return (target, key, descriptor) => {\n        const name = events ? events.toString() : key;\n        Reflect.defineMetadata(`apprun-update:${name}`, { name, key, options }, target);\n        return descriptor;\n    };\n}\nexport function on(events, options = {}) {\n    return function (target, key) {\n        const name = events ? events.toString() : key;\n        Reflect.defineMetadata(`apprun-update:${name}`, { name, key, options }, target);\n    };\n}\nexport function customElement(name, options) {\n    return function _customElement(constructor) {\n        webComponent(name, constructor, options);\n        return constructor;\n    };\n}\n//# sourceMappingURL=decorator.js.map","/**\n * AppRun Component System Implementation\n *\n * This file provides the Component class which is the foundation for:\n * 1. State Management\n *    - Maintains component state\n *    - Handles state updates\n *    - Supports state history\n *\n * 2. View Rendering\n *    - Renders virtual DOM to real DOM\n *    - Handles component lifecycle (mounted, rendered, unload)\n *    - Supports shadow DOM and web components\n *\n * 3. Event Handling\n *    - Local and global event subscription\n *    - Event handler registration via decorators\n *    - Action to state updates\n *\n * Usage:\n * ```ts\n * class MyComponent extends Component {\n *   state = // Initial state\n *   view = state => // Return virtual DOM\n *   update = {\n *     'event': (state, ...args) => // Return new state\n *   }\n * }\n *\n * // Mount component\n * new MyComponent().mount('element-id');\n * ```\n */\nimport app, { App } from './app';\nimport { Reflect } from './decorator';\nimport directive from './directive';\nconst componentCache = new Map();\nif (!app.find('get-components'))\n    app.on('get-components', o => o.components = componentCache);\nconst REFRESH = state => state;\nexport class Component {\n    renderState(state, vdom = null) {\n        if (!this.view)\n            return;\n        let html = vdom || this.view(state);\n        app['debug'] && app.run('debug', {\n            component: this,\n            _: html ? '.' : '-',\n            state,\n            vdom: html,\n            el: this.element\n        });\n        if (typeof document !== 'object')\n            return;\n        const el = (typeof this.element === 'string' && this.element) ?\n            document.getElementById(this.element) || document.querySelector(this.element) : this.element;\n        if (!el)\n            return;\n        const tracking_attr = '_c';\n        if (!this.unload) {\n            el.removeAttribute && el.removeAttribute(tracking_attr);\n        }\n        else if (el['_component'] !== this || el.getAttribute(tracking_attr) !== this.tracking_id) {\n            this.tracking_id = new Date().valueOf().toString();\n            el.setAttribute(tracking_attr, this.tracking_id);\n            if (typeof MutationObserver !== 'undefined') {\n                if (!this.observer)\n                    this.observer = new MutationObserver(changes => {\n                        if (changes[0].oldValue === this.tracking_id || !document.body.contains(el)) {\n                            this.unload(this.state);\n                            this.observer.disconnect();\n                            this.observer = null;\n                        }\n                    });\n                this.observer.observe(document.body, {\n                    childList: true, subtree: true,\n                    attributes: true, attributeOldValue: true, attributeFilter: [tracking_attr]\n                });\n            }\n        }\n        el['_component'] = this;\n        if (!vdom && html) {\n            html = directive(html, this);\n            if (this.options.transition && document && document['startViewTransition']) {\n                document['startViewTransition'](() => app.render(el, html, this));\n            }\n            else {\n                app.render(el, html, this);\n            }\n        }\n        this.rendered && this.rendered(this.state);\n    }\n    setState(state, options = { render: true, history: false }) {\n        const handleAsyncIterator = async (iterator) => {\n            try {\n                while (true) {\n                    const { value, done } = await iterator.next();\n                    if (done)\n                        break;\n                    this.setState(value, options);\n                }\n            }\n            catch (e) {\n                console.error('Error in async iterator:', e);\n            }\n        };\n        const result = state;\n        if (result === null || result === void 0 ? void 0 : result[Symbol.asyncIterator]) {\n            // handleAsyncIterator(result[Symbol.asyncIterator]());\n            this.setState(handleAsyncIterator(result[Symbol.asyncIterator]()), options);\n            return;\n        }\n        else if ((result === null || result === void 0 ? void 0 : result[Symbol.iterator]) && typeof result.next === \"function\") {\n            for (const value of result) {\n                this.setState(value, options);\n            }\n            return;\n        }\n        else if (state && state instanceof Promise) {\n            // Promise will not be saved or rendered\n            // state will be saved and rendered when promise is resolved\n            Promise.resolve(state).then(v => {\n                this.setState(v, options);\n                this._state = state;\n            });\n        }\n        else {\n            this._state = state;\n            if (state == null)\n                return;\n            this.state = state;\n            if (options.render !== false) {\n                // before render state\n                if (options.transition && document && document['startViewTransition']) {\n                    document['startViewTransition'](() => this.renderState(state));\n                }\n                else {\n                    this.renderState(state);\n                }\n            }\n            if (options.history !== false && this.enable_history) {\n                this._history = [...this._history, state];\n                this._history_idx = this._history.length - 1;\n            }\n            if (typeof options.callback === 'function')\n                options.callback(this.state);\n        }\n    }\n    constructor(state, view, update, options) {\n        this.state = state;\n        this.view = view;\n        this.update = update;\n        this.options = options;\n        this._app = new App();\n        this._actions = [];\n        this._global_events = [];\n        this._history = [];\n        this._history_idx = -1;\n        this._history_prev = () => {\n            this._history_idx--;\n            if (this._history_idx >= 0) {\n                this.setState(this._history[this._history_idx], { render: true, history: false });\n            }\n            else {\n                this._history_idx = 0;\n            }\n        };\n        this._history_next = () => {\n            this._history_idx++;\n            if (this._history_idx < this._history.length) {\n                this.setState(this._history[this._history_idx], { render: true, history: false });\n            }\n            else {\n                this._history_idx = this._history.length - 1;\n            }\n        };\n        this.start = (element = null, options) => {\n            this.mount(element, Object.assign({ render: true }, options));\n            if (this.mounted && typeof this.mounted === 'function') {\n                const new_state = this.mounted({}, [], this.state);\n                (typeof new_state !== 'undefined') && this.setState(new_state);\n            }\n            return this;\n        };\n    }\n    mount(element = null, options) {\n        var _a, _b;\n        console.assert(!this.element, 'Component already mounted.');\n        this.options = options = Object.assign(Object.assign({}, this.options), options);\n        this.element = element;\n        this.global_event = options.global_event;\n        this.enable_history = !!options.history;\n        if (this.enable_history) {\n            this.on(options.history.prev || 'history-prev', this._history_prev);\n            this.on(options.history.next || 'history-next', this._history_next);\n        }\n        if (options.route) {\n            this.update = this.update || {};\n            if (!this.update[options.route])\n                this.update[options.route] = REFRESH;\n        }\n        this.add_actions();\n        this.state = (_b = (_a = this.state) !== null && _a !== void 0 ? _a : this['model']) !== null && _b !== void 0 ? _b : {};\n        if (typeof this.state === 'function')\n            this.state = this.state();\n        this.setState(this.state, { render: !!options.render, history: true });\n        if (app['debug']) {\n            if (componentCache.get(element)) {\n                componentCache.get(element).push(this);\n            }\n            else {\n                componentCache.set(element, [this]);\n            }\n        }\n        return this;\n    }\n    is_global_event(name) {\n        return name && (this.global_event ||\n            this._global_events.indexOf(name) >= 0 ||\n            name.startsWith('#') || name.startsWith('/') || name.startsWith('@'));\n    }\n    add_action(name, action, options = {}) {\n        if (!action || typeof action !== 'function')\n            return;\n        if (options.global)\n            this._global_events.push(name);\n        this.on(name, (...p) => {\n            app['debug'] && app.run('debug', {\n                component: this,\n                _: '>',\n                event: name, p,\n                current_state: this.state,\n                options\n            });\n            const newState = action(this.state, ...p);\n            app['debug'] && app.run('debug', {\n                component: this,\n                _: '<',\n                event: name, p,\n                newState,\n                state: this.state,\n                options\n            });\n            this.setState(newState, options);\n        }, options);\n    }\n    add_actions() {\n        const actions = this.update || {};\n        Reflect.getMetadataKeys(this).forEach(key => {\n            if (key.startsWith('apprun-update:')) {\n                const meta = Reflect.getMetadata(key, this);\n                actions[meta.name] = [this[meta.key].bind(this), meta.options];\n            }\n        });\n        const all = {};\n        if (Array.isArray(actions)) {\n            actions.forEach(act => {\n                const [name, action, opts] = act;\n                const names = name.toString();\n                names.split(',').forEach(n => all[n.trim()] = [action, opts]);\n            });\n        }\n        else {\n            Object.keys(actions).forEach(name => {\n                const action = actions[name];\n                if (typeof action === 'function' || Array.isArray(action)) {\n                    name.split(',').forEach(n => all[n.trim()] = action);\n                }\n            });\n        }\n        if (!all['.'])\n            all['.'] = REFRESH;\n        Object.keys(all).forEach(name => {\n            const action = all[name];\n            if (typeof action === 'function') {\n                this.add_action(name, action);\n            }\n            else if (Array.isArray(action)) {\n                this.add_action(name, action[0], action[1]);\n            }\n        });\n    }\n    run(event, ...args) {\n        if (this.state instanceof Promise) {\n            return Promise.resolve(this.state).then(state => {\n                this.state = state;\n                this.run(event, ...args);\n            });\n        }\n        else {\n            const name = event.toString();\n            return this.is_global_event(name) ?\n                app.run(name, ...args) :\n                this._app.run(name, ...args);\n        }\n    }\n    on(event, fn, options) {\n        const name = event.toString();\n        this._actions.push({ name, fn });\n        return this.is_global_event(name) ?\n            app.on(name, fn, options) :\n            this._app.on(name, fn, options);\n    }\n    runAsync(event, ...args) {\n        const name = event.toString();\n        return this.is_global_event(name) ?\n            app.runAsync(name, ...args) :\n            this._app.runAsync(name, ...args);\n    }\n    // obsolete\n    query(event, ...args) {\n        return this.runAsync(event, ...args);\n    }\n    unmount() {\n        var _a;\n        (_a = this.observer) === null || _a === void 0 ? void 0 : _a.disconnect();\n        this._actions.forEach(action => {\n            const { name, fn } = action;\n            this.is_global_event(name) ?\n                app.off(name, fn) :\n                this._app.off(name, fn);\n        });\n    }\n}\nComponent.__isAppRunComponent = true;\n//# sourceMappingURL=component.js.map","/**\n * AppRun Router Implementation\n *\n * This file provides URL routing capabilities:\n * 1. Hash-based routing (#/path)\n * 2. Path-based routing (/path)\n * 3. Event-based navigation\n *\n * Features:\n * - Automatic route event firing\n * - 404 handling via ROUTER_404_EVENT\n * - History API integration\n * - Route parameter parsing\n *\n * Usage:\n * ```ts\n * // Handle routes\n * app.on('#/home', () => // Show home page);\n * app.on('#/users/:id', (id) => // Show user profile);\n *\n * // Navigate programmatically\n * app.run('route', '#/home');\n * ```\n */\nimport app from './app';\nexport const ROUTER_EVENT = '//';\nexport const ROUTER_404_EVENT = '///';\nexport const route = (url) => {\n    if (app['lastUrl'] === url)\n        return; // Prevent duplicate routing\n    app['lastUrl'] = url;\n    if (!url)\n        url = '#';\n    if (url.startsWith('#')) {\n        const [name, ...rest] = url.split('/');\n        app.run(name, ...rest) || app.run(ROUTER_404_EVENT, name, ...rest);\n        app.run(ROUTER_EVENT, name, ...rest);\n    }\n    else if (url.startsWith('/')) {\n        const [_, name, ...rest] = url.split('/');\n        app.run('/' + name, ...rest) || app.run(ROUTER_404_EVENT, '/' + name, ...rest);\n        app.run(ROUTER_EVENT, '/' + name, ...rest);\n    }\n    else {\n        app.run(url) || app.run(ROUTER_404_EVENT, url);\n        app.run(ROUTER_EVENT, url);\n    }\n};\nexport default route;\n//# sourceMappingURL=router.js.map","/**\n * Main AppRun framework entry point\n *\n * This file:\n * 1. Assembles core AppRun modules into a complete framework\n * 2. Exports public API and types\n * 3. Initializes global app instance with:\n *    - Virtual DOM rendering\n *    - Component system\n *    - Router\n *    - Web component support\n *\n * Key exports:\n * - app: Global event system instance\n * - Component: Base component class\n * - Decorators: @on, @update, @customElement\n * - Router events and configuration\n * - Web component registration\n *\n * Usage:\n * ```ts\n * import { app, Component } from 'apprun';\n *\n * // Create components\n * class MyComponent extends Component {\n *   state = // Initial state\n *   view = state => // Render view\n *   update = {\n *     'event': (state, ...args) => // Handle events\n *   }\n * }\n * ```\n */\nimport app, { App } from './app';\nimport { createElement, render, Fragment, safeHTML } from './vdom';\nimport { Component } from './component';\nimport { on, update, customElement } from './decorator';\nimport webComponent from './web-component';\nimport { route, ROUTER_EVENT, ROUTER_404_EVENT } from './router';\nexport { App, app, Component, on, update, Fragment, safeHTML };\nexport { update as event };\nexport { ROUTER_EVENT, ROUTER_404_EVENT };\nexport { customElement };\nexport default app;\nif (!app.start) {\n    app.version = '3.35.0';\n    app.h = app.createElement = createElement;\n    app.render = render;\n    app.Fragment = Fragment;\n    app.webComponent = webComponent;\n    app.safeHTML = safeHTML;\n    app.start = (element, model, view, update, options) => {\n        const opts = Object.assign({ render: true, global_event: true }, options);\n        const component = new Component(model, view, update);\n        if (options && options.rendered)\n            component.rendered = options.rendered;\n        if (options && options.mounted)\n            component.mounted = options.mounted;\n        component.start(element, opts);\n        return component;\n    };\n    const NOOP = _ => { };\n    // app.on('$', NOOP);\n    app.on('debug', _ => NOOP);\n    app.on(ROUTER_EVENT, NOOP);\n    app.on(ROUTER_404_EVENT, NOOP);\n    app.route = route;\n    app.on('route', url => app['route'] && app['route'](url));\n    if (typeof document === 'object') {\n        document.addEventListener(\"DOMContentLoaded\", () => {\n            const init_load = document.body.hasAttribute('apprun-no-init') || app['no-init-route'] || false;\n            const use_hash = app.find('#') || app.find('#/') || false;\n            // console.log(`AppRun ${app.version} started with ${use_hash ? 'hash' : 'path'} routing. Initial load: ${init_load ? 'disabled' : 'enabled'}.`);\n            window.addEventListener('hashchange', () => route(location.hash));\n            window.addEventListener('popstate', () => route(location.pathname));\n            if (use_hash) {\n                init_load && route(location.hash);\n            }\n            else {\n                init_load && route(location.pathname);\n                document.body.addEventListener('click', e => {\n                    const element = e.target;\n                    const menu = (element.tagName === 'A' ? element : element.closest('a'));\n                    if (menu &&\n                        menu.origin === location.origin) {\n                        e.preventDefault();\n                        history.pushState(null, '', menu.pathname);\n                        route(menu.pathname);\n                    }\n                });\n            }\n        });\n    }\n    if (typeof window === 'object') {\n        window['Component'] = Component;\n        window['_React'] = window['React'];\n        window['React'] = app;\n        window['on'] = on;\n        window['customElement'] = customElement;\n        window['safeHTML'] = safeHTML;\n    }\n    app.use_render = (render, mode = 0) => {\n        if (mode === 0) {\n            app.render = (el, vdom) => render(vdom, el); // react style\n        }\n        else {\n            app.render = (el, vdom) => render(el, vdom); // apprun style\n        }\n    };\n    app.use_react = (React, ReactDOM) => {\n        app.h = app.createElement = React.createElement;\n        app.Fragment = React.Fragment;\n        app.render = (el, vdom) => ReactDOM.render(vdom, el);\n        if (React.version && React.version.startsWith('18')) {\n            app.render = (el, vdom) => {\n                if (!el || !vdom)\n                    return;\n                if (!el._root)\n                    el._root = ReactDOM.createRoot(el);\n                el._root.render(vdom);\n            };\n        }\n    };\n}\n//# sourceMappingURL=apprun.js.map"],"names":["App","constructor","this","_events","on","name","fn","options","push","off","subscribers","filter","sub","find","run","args","getSubscribers","console","assert","length","forEach","delay","Object","keys","apply","once","assign","_t","clearTimeout","setTimeout","runAsync","promises","map","Promise","all","query","events","evt","endsWith","startsWith","replace","sort","a","b","event","_app","root","window","global","self","app","_AppRunVersions","getStateValue","component","setStateValue","value","state","setState","directive","vdom","Array","isArray","element","type","tag","props","children","key","substring","e","handler","p","target","checked","Number","multiple","selected","apply_directive","Fragment","collect","ATTR_PROPS","ch","c","i","keyCache","WeakMap","updateElement","nodes","parent","createComponent","isSvg","nodeName","updateChildren","render","document","getElementById","querySelector","update","node","el","key1","key2","toUpperCase","same","parentNode","replaceChild","create","updateProps","_a","_b","old_len","childNodes","new_len","len","Math","min","child","textContent","nodeType","nodeValue","createText","HTMLElement","SVGElement","insertBefore","old","temp","nextSibling","appendChild","n","removeChild","lastChild","d","createDocumentFragment","safeHTML","html","div","createElement","insertAdjacentHTML","from","indexOf","createTextNode","JSON","stringify","createElementNS","cached","oldProps","newProps","mergeProps","cname","match","dataset","style","cssText","s","xname","toLowerCase","removeAttributeNS","setAttributeNS","setAttribute","removeAttribute","test","getAttribute","requestAnimationFrame","idx","getPrototypeOf","__isAppRunComponent","id","Date","now","asTag","__componentCache","renderState","mount","mounted","new_state","render_component","new_parent","_component","customElement","componentClass","super","observedAttributes","attr","connectedCallback","isConnected","opts","_shadowRoot","shadow","attachShadow","mode","attrMap","reduce","lc","_attrMap","attributes","item","undefined","defineProperty","get","set","attributeChangedCallback","configurable","enumerable","_props","dispatchEvent","bind","disconnectedCallback","_c","_d","unload","call","unmount","oldValue","mappedName","webComponent","customElements","define","Reflect","meta","defineMetadata","metadataKey","metadataValue","has","getMetadataKeys","getMetadata","descriptor","toString","componentCache","Map","o","components","REFRESH","Component","view","_","tracking_attr","tracking_id","valueOf","MutationObserver","observer","changes","body","contains","disconnect","observe","childList","subtree","attributeOldValue","attributeFilter","transition","rendered","history","handleAsyncIterator","async","iterator","done","next","error","result","Symbol","asyncIterator","resolve","then","v","_state","enable_history","_history","_history_idx","callback","_actions","_global_events","_history_prev","_history_next","start","global_event","prev","route","add_actions","is_global_event","add_action","action","current_state","newState","actions","act","split","trim","ROUTER_EVENT","ROUTER_404_EVENT","url","rest","version","h","Error","model","NOOP","addEventListener","init_load","hasAttribute","use_hash","location","hash","pathname","menu","tagName","closest","origin","preventDefault","pushState","use_render","use_react","React","ReactDOM","_root","createRoot"],"mappings":"AA2BO,MAAMA,EACT,WAAAC,GACIC,KAAKC,QAAU,CAAE,CACzB,CACI,EAAAC,CAAGC,EAAMC,EAAIC,EAAU,CAAA,GACnBL,KAAKC,QAAQE,GAAQH,KAAKC,QAAQE,IAAS,GAC3CH,KAAKC,QAAQE,GAAMG,KAAK,CAAEF,KAAIC,WACtC,CACI,GAAAE,CAAIJ,EAAMC,GACN,MAAMI,EAAcR,KAAKC,QAAQE,IAAS,GAC1CH,KAAKC,QAAQE,GAAQK,EAAYC,QAAQC,GAAQA,EAAIN,KAAOA,GACpE,CACI,IAAAO,CAAKR,GACD,OAAOH,KAAKC,QAAQE,EAC5B,CACI,GAAAS,CAAIT,KAASU,GACT,MAAML,EAAcR,KAAKc,eAAeX,EAAMH,KAAKC,SAYnD,OAXAc,QAAQC,OAAOR,GAAeA,EAAYS,OAAS,EAAG,4BAA8Bd,GACpFK,EAAYU,SAASR,IACjB,MAAMN,GAAEA,EAAEC,QAAEA,GAAYK,EAOxB,OANIL,EAAQc,MACRnB,KAAKmB,MAAMhB,EAAMC,EAAIS,EAAMR,GAG3Be,OAAOC,KAAKhB,GAASY,OAAS,EAAIb,EAAGkB,MAAMtB,KAAM,IAAIa,EAAMR,IAAYD,EAAGkB,MAAMtB,KAAMa,IAElFH,EAAIL,QAAQkB,IAAI,IAErBf,EAAYS,MAC3B,CACI,IAAAM,CAAKpB,EAAMC,EAAIC,EAAU,CAAA,GACrBL,KAAKE,GAAGC,EAAMC,EAAIgB,OAAOI,OAAOJ,OAAOI,OAAO,CAAA,EAAInB,GAAU,CAAEkB,MAAM,IAC5E,CACI,KAAAJ,CAAMhB,EAAMC,EAAIS,EAAMR,GACdA,EAAQoB,IACRC,aAAarB,EAAQoB,IACzBpB,EAAQoB,GAAKE,YAAW,KACpBD,aAAarB,EAAQoB,IACrBL,OAAOC,KAAKhB,GAASY,OAAS,EAAIb,EAAGkB,MAAMtB,KAAM,IAAIa,EAAMR,IAAYD,EAAGkB,MAAMtB,KAAMa,EAAK,GAC5FR,EAAQc,MACnB,CACI,QAAAS,CAASzB,KAASU,GACd,MAAML,EAAcR,KAAKc,eAAeX,EAAMH,KAAKC,SACnDc,QAAQC,OAAOR,GAAeA,EAAYS,OAAS,EAAG,4BAA8Bd,GACpF,MAAM0B,EAAWrB,EAAYsB,KAAIpB,IAC7B,MAAMN,GAAEA,EAAEC,QAAEA,GAAYK,EACxB,OAAOU,OAAOC,KAAKhB,GAASY,OAAS,EAAIb,EAAGkB,MAAMtB,KAAM,IAAIa,EAAMR,IAAYD,EAAGkB,MAAMtB,KAAMa,EAAK,IAEtG,OAAOkB,QAAQC,IAAIH,EAC3B,CACI,KAAAI,CAAM9B,KAASU,GACX,OAAOb,KAAK4B,SAASzB,KAASU,EACtC,CACI,cAAAC,CAAeX,EAAM+B,GACjB,MAAM1B,EAAc0B,EAAO/B,IAAS,GAUpC,OANA+B,EAAO/B,GAAQK,EAAYC,QAAQC,IACvBA,EAAIL,QAAQkB,OAExBH,OAAOC,KAAKa,GAAQzB,QAAO0B,GAAOA,EAAIC,SAAS,MAAQjC,EAAKkC,WAAWF,EAAIG,QAAQ,IAAK,OACnFC,MAAK,CAACC,EAAGC,IAAMA,EAAExB,OAASuB,EAAEvB,SAC5BC,SAAQiB,GAAO3B,EAAYF,QAAQ4B,EAAOC,GAAKL,KAAIpB,GAAQU,OAAOI,OAAOJ,OAAOI,OAAO,CAAE,EAAEd,GAAM,CAAEL,QAASe,OAAOI,OAAOJ,OAAOI,OAAO,CAAE,EAAEd,EAAIL,SAAU,CAAEqC,MAAOvC,WACjKK,CACf,EAGA,IAAImC,EACJ,MAAMC,EAA0B,oBAAXC,OAAyBA,OACxB,oBAAXC,OAAyBA,OACZ,oBAATC,KAAuBA,KAAO,GACzCH,EAAKI,KAAOJ,EAAKK,gBACjBN,EAAOC,EAAKI,KAGZL,EAAO,IAAI7C,EACX8C,EAAKI,IAAML,EACXC,EAAKK,gBAXc,iBAavB,IAAAD,EAAeL,EC3Ef,MAAMO,EAAgB,CAACC,EAAWhD,KACtBA,EAAOgD,EAAiB,MAAEhD,GAAQgD,EAAiB,QAAM,GAE/DC,EAAgB,CAACD,EAAWhD,EAAMkD,KACpC,GAAIlD,EAAM,CACN,MAAMmD,EAAQH,EAAiB,OAAK,CAAE,EACtCG,EAAMnD,GAAQkD,EACdF,EAAUI,SAASD,EAC3B,MAEQH,EAAUI,SAASF,EAC3B,EAqEMG,EAAY,CAACC,EAAMN,KACrB,GAAIO,MAAMC,QAAQF,GACd,OAAOA,EAAK3B,KAAI8B,GAAWJ,EAAUI,EAAST,KAE7C,CACD,IAAIU,KAAEA,EAAIC,IAAEA,EAAGC,MAAEA,EAAKC,SAAEA,GAAaP,EAYrC,OAXAK,EAAMA,GAAOD,EACbG,EAAWA,IAAaD,aAAqC,EAASA,EAAMC,UACxED,GACA3C,OAAOC,KAAK0C,GAAO7C,SAAQ+C,IACnBA,EAAI5B,WAAW,OA7EX,EAAC4B,EAAKF,EAAOD,EAAKX,KACtC,GAAIc,EAAI5B,WAAW,OAAQ,CACvB,MAAMK,EAAQqB,EAAME,GAEpB,GADAA,EAAMA,EAAIC,UAAU,GACC,kBAAVxB,EACPqB,EAAME,GAAOE,GAAKhB,EAAUvC,IAAMuC,EAAUvC,IAAIqD,EAAKE,GAAKnB,EAAIpC,IAAIqD,EAAKE,QAEtE,GAAqB,iBAAVzB,EACZqB,EAAME,GAAOE,GAAKhB,EAAUvC,IAAMuC,EAAUvC,IAAI8B,EAAOyB,GAAKnB,EAAIpC,IAAI8B,EAAOyB,QAE1E,GAAqB,mBAAVzB,EACZqB,EAAME,GAAOE,GAAKhB,EAAUI,SAASb,EAAMS,EAAUG,MAAOa,SAE3D,GAAIT,MAAMC,QAAQjB,GAAQ,CAC3B,MAAO0B,KAAYC,GAAK3B,EACD,iBAAZ0B,EACPL,EAAME,GAAOE,GAAKhB,EAAUvC,IAAMuC,EAAUvC,IAAIwD,KAAYC,EAAGF,GAAKnB,EAAIpC,IAAIwD,KAAYC,EAAGF,GAEnE,mBAAZC,IACZL,EAAME,GAAOE,GAAKhB,EAAUI,SAASa,EAAQjB,EAAUG,SAAUe,EAAGF,IAEpF,CACA,MACS,GAAY,UAARF,EAAiB,CACtB,MAAMJ,EAAOE,EAAY,MAAK,OACxB5D,EAA6B,iBAAf4D,EAAME,GAAoBF,EAAME,GAAOF,EAAY,KACvE,GAAY,UAARD,EACA,OAAQD,GACJ,IAAK,WACDE,EAAe,QAAIb,EAAcC,EAAWhD,GAC5C4D,EAAe,QAAII,GAAKf,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMgE,EAAEG,OAAOC,SACjF,MACJ,IAAK,QACDR,EAAe,QAAIb,EAAcC,EAAWhD,KAAU4D,EAAa,MACnEA,EAAe,QAAII,GAAKf,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMgE,EAAEG,OAAOjB,OACjF,MACJ,IAAK,SACL,IAAK,QACDU,EAAa,MAAIb,EAAcC,EAAWhD,GAC1C4D,EAAe,QAAII,GAAKf,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMqE,OAAOL,EAAEG,OAAOjB,QACxF,MACJ,QACIU,EAAa,MAAIb,EAAcC,EAAWhD,GAC1C4D,EAAe,QAAII,GAAKf,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMgE,EAAEG,OAAOjB,WAG5E,WAARS,GACLC,EAAa,MAAIb,EAAcC,EAAWhD,GAC1C4D,EAAgB,SAAII,IACXA,EAAEG,OAAOG,UACVrB,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMgE,EAAEG,OAAOjB,MAC7E,GAGyB,WAARS,GACLC,EAAgB,SAAIb,EAAcC,EAAWhD,GAC7C4D,EAAe,QAAII,GAAKf,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMgE,EAAEG,OAAOI,WAEpE,aAARZ,IACLC,EAAiB,UAAIb,EAAcC,EAAWhD,GAC9C4D,EAAe,QAAII,GAAKf,EAAcD,EAAWhD,GAAQgE,EAAEG,OAAOnE,KAAMgE,EAAEG,OAAOjB,OAE7F,MAEQL,EAAIpC,IAAI,IAAK,CAAEqD,MAAKH,MAAKC,QAAOZ,aACxC,EAaoBwB,CAAgBV,EAAKF,EAAOD,EAAKX,UAC1BY,EAAME,GACjC,IAEYD,GACAR,EAAUQ,EAAUb,GACjBM,CACf,GCjIO,SAASmB,EAASb,KAAUC,GAC/B,OAAOa,EAAQb,EACnB,CACA,MAAMc,EAAa,SACnB,SAASD,EAAQb,GACb,MAAMe,EAAK,GACLzE,EAAQ0E,IACNA,SAAuC,KAANA,IAAkB,IAANA,GAC7CD,EAAGzE,KAAmB,mBAAN0E,GAAiC,iBAANA,EAAkBA,EAAI,GAAGA,IAChF,EAUI,OARAhB,GAAYA,EAAS9C,SAAQ8D,IACrBtB,MAAMC,QAAQqB,GACdA,EAAE9D,SAAQ+D,GAAK3E,EAAK2E,KAGpB3E,EAAK0E,EACjB,IAEWD,CACX,CAiBA,MAAMG,EAAW,IAAIC,QACRC,EAAgB,CAACxB,EAASyB,EAAOlC,EAAY,CAAA,KAEtD,GAAa,MAATkC,IAA2B,IAAVA,EACjB,QAMR,SAAgBzB,EAASyB,EAAOC,EAAS,CAAA,GAErC,GAAa,MAATD,IAA2B,IAAVA,EACjB,OAEJ,GADAA,EAAQE,EAAgBF,EAAOC,IAC1B1B,EACD,OACJ,MAAM4B,EAA6B,QAArB5B,EAAQ6B,SAClB/B,MAAMC,QAAQ0B,GACdK,EAAe9B,EAASyB,EAAOG,GAG/BE,EAAe9B,EAAS,CAACyB,GAAQG,EAEzC,CAhBIG,CAH+B,iBAAZ/B,GAAwBA,EACvCgC,SAASC,eAAejC,IAAYgC,SAASE,cAAclC,GAAWA,EAC1EyB,EAAQ7B,EAAU6B,EAAOlC,GACPA,EAAU,EAuBhC,SAAS4C,EAAOnC,EAASoC,EAAMR,GACP,IAAhBQ,EAAU,MAGdR,EAAQA,GAAsB,QAAbQ,EAAKlC,KAV1B,SAAcmC,EAAID,GAEd,MAAME,EAAOD,EAAGR,SACVU,EAAO,GAAGH,EAAKlC,KAAO,KAC5B,OAAOoC,EAAKE,gBAAkBD,EAAKC,aACvC,CAMSC,CAAKzC,EAASoC,GACfpC,EAAQ0C,WAAWC,aAAaC,EAAOR,EAAMR,GAAQ5B,MAGzC,EAAdoC,EAAU,MAAUN,EAAe9B,EAASoC,EAAKhC,SAAUwB,KAC7C,EAAdQ,EAAU,MAAUS,EAAY7C,EAASoC,EAAKjC,MAAOyB,IAC3D,CACA,SAASE,EAAe9B,EAASI,EAAUwB,GACvC,IAAIkB,EAAIC,EACR,MAAMC,GAAyC,QAA7BF,EAAK9C,EAAQiD,kBAA+B,IAAPH,OAAgB,EAASA,EAAGzF,SAAW,EACxF6F,GAAW9C,aAA2C,EAASA,EAAS/C,SAAW,EACnF8F,EAAMC,KAAKC,IAAIL,EAASE,GAC9B,IAAK,IAAI7B,EAAI,EAAGA,EAAI8B,EAAK9B,IAAK,CAC1B,MAAMiC,EAAQlD,EAASiB,GACvB,GAAqB,IAAjBiC,EAAW,IACX,SACJ,MAAMjB,EAAKrC,EAAQiD,WAAW5B,GAC9B,GAAqB,iBAAViC,EACHjB,EAAGkB,cAAgBD,IACC,IAAhBjB,EAAGmB,SACHnB,EAAGoB,UAAYH,EAGftD,EAAQ2C,aAAae,EAAWJ,GAAQjB,SAI/C,GAAIiB,aAAiBK,aAAeL,aAAiBM,WACtD5D,EAAQ6D,aAAaP,EAAOjB,OAE3B,CACD,MAAMhC,EAAMiD,EAAMnD,OAASmD,EAAMnD,MAAW,IAC5C,GAAIE,EACA,GAAIgC,EAAGhC,MAAQA,EACX8B,EAAOnC,EAAQiD,WAAW5B,GAAIiC,EAAO1B,OAEpC,CAED,MAAMkC,EAAMxC,EAASjB,GACrB,GAAIyD,EAAK,CACL,MAAMC,EAAOD,EAAIE,YACjBhE,EAAQ6D,aAAaC,EAAKzB,GAC1B0B,EAAO/D,EAAQ6D,aAAaxB,EAAI0B,GAAQ/D,EAAQiE,YAAY5B,GAC5DF,EAAOnC,EAAQiD,WAAW5B,GAAIiC,EAAO1B,EAC7D,MAEwB5B,EAAQ2C,aAAaC,EAAOU,EAAO1B,GAAQS,EAEnE,MAGgBF,EAAOnC,EAAQiD,WAAW5B,GAAIiC,EAAO1B,EAErD,CACA,CACI,IAAIsC,GAAmC,QAA7BnB,EAAK/C,EAAQiD,kBAA+B,IAAPF,OAAgB,EAASA,EAAG1F,SAAW,EACtF,KAAO6G,EAAIf,GACPnD,EAAQmE,YAAYnE,EAAQoE,WAC5BF,IAEJ,GAAIhB,EAAUC,EAAK,CACf,MAAMkB,EAAIrC,SAASsC,yBACnB,IAAK,IAAIjD,EAAI8B,EAAK9B,EAAIjB,EAAS/C,OAAQgE,IACnCgD,EAAEJ,YAAYrB,EAAOxC,EAASiB,GAAIO,IAEtC5B,EAAQiE,YAAYI,EAC5B,CACA,CACY,MAACE,EAAYC,IACrB,MAAMC,EAAMzC,SAAS0C,cAAc,WAEnC,OADAD,EAAIE,mBAAmB,aAAcH,GAC9B1E,MAAM8E,KAAKH,EAAIrE,SAAS,EAEnC,SAASsD,EAAWtB,GAChB,GAA6E,KAAxEA,aAAmC,EAASA,EAAKyC,QAAQ,WAAkB,CAC5E,MAAMJ,EAAMzC,SAAS0C,cAAc,OAEnC,OADAD,EAAIE,mBAAmB,aAAcvC,EAAK9B,UAAU,IAC7CmE,CACf,CAEQ,OAAOzC,SAAS8C,eAAe1C,QAAmCA,EAAO,GAEjF,CACA,SAASQ,EAAOR,EAAMR,GAElB,GAAKQ,aAAgBuB,aAAiBvB,aAAgBwB,WAClD,OAAOxB,EACX,GAAoB,iBAATA,EACP,OAAOsB,EAAWtB,GACtB,IAAKA,EAAKlC,KAA4B,mBAAbkC,EAAKlC,IAC1B,OAAOwD,EAAWqB,KAAKC,UAAU5C,IAErC,MAAMpC,GADN4B,EAAQA,GAAsB,QAAbQ,EAAKlC,KAEhB8B,SAASiD,gBAAgB,6BAA8B7C,EAAKlC,KAC5D8B,SAAS0C,cAActC,EAAKlC,KAIlC,OAHA2C,EAAY7C,EAASoC,EAAKjC,MAAOyB,GAC7BQ,EAAKhC,UACLgC,EAAKhC,SAAS9C,SAAQgG,GAAStD,EAAQiE,YAAYrB,EAAOU,EAAO1B,MAC9D5B,CACX,CAWO,SAAS6C,EAAY7C,EAASG,EAAOyB,GAExC,MAAMsD,EAASlF,EAAQkB,IAAe,CAAE,EACxCf,EAbJ,SAAoBgF,EAAUC,GAC1BA,EAAgB,MAAIA,EAAgB,OAAKA,EAAoB,iBACtDA,EAAoB,UAC3B,MAAMjF,EAAQ,CAAE,EAKhB,OAJIgF,GACA3H,OAAOC,KAAK0H,GAAU7H,SAAQmD,GAAKN,EAAMM,GAAK,OAE9CjD,OAAOC,KAAK2H,GAAU9H,SAAQmD,GAAKN,EAAMM,GAAK2E,EAAS3E,KACpDN,CACX,CAIYkF,CAAWH,EAAQ/E,GAAS,CAAA,GACpCH,EAAQkB,GAAcf,EACtB,IAAK,MAAM5D,KAAQ4D,EAAO,CACtB,MAAMV,EAAQU,EAAM5D,GAGpB,GAAIA,EAAKkC,WAAW,SAAU,CAC1B,MACM6G,EADQ/I,EAAK+D,UAAU,GACT5B,QAAQ,UAAW6G,GAAUA,EAAM,GAAG/C,gBACtDxC,EAAQwF,QAAQF,KAAW7F,IACvBA,GAAmB,KAAVA,EACTO,EAAQwF,QAAQF,GAAS7F,SAElBO,EAAQwF,QAAQF,GAE3C,MACa,GAAa,UAAT/I,EAGL,GAFIyD,EAAQyF,MAAMC,UACd1F,EAAQyF,MAAMC,QAAU,IACP,iBAAVjG,EACPO,EAAQyF,MAAMC,QAAUjG,OAExB,IAAK,MAAMkG,KAAKlG,EACRO,EAAQyF,MAAME,KAAOlG,EAAMkG,KAC3B3F,EAAQyF,MAAME,GAAKlG,EAAMkG,SAIpC,GAAIpJ,EAAKkC,WAAW,SAAU,CAC/B,MAAMmH,EAAQrJ,EAAKmC,QAAQ,QAAS,IAAImH,cAC3B,MAATpG,IAA2B,IAAVA,EACjBO,EAAQ8F,kBAAkB,+BAAgCF,GAG1D5F,EAAQ+F,eAAe,+BAAgCH,EAAOnG,EAE9E,MACiBlD,EAAKkC,WAAW,MAChBgB,GAA0B,mBAAVA,EAGK,iBAAVA,IACRA,EACAO,EAAQgG,aAAazJ,EAAMkD,GAE3BO,EAAQiG,gBAAgB1J,IAN5ByD,EAAQzD,GAAQkD,EASf,kEAAkEyG,KAAK3J,IAASqF,EACjF5B,EAAQmG,aAAa5J,KAAUkD,IAC3BA,EACAO,EAAQgG,aAAazJ,EAAMkD,GAE3BO,EAAQiG,gBAAgB1J,IAG3ByD,EAAQzD,KAAUkD,IACvBO,EAAQzD,GAAQkD,GAEP,QAATlD,GAAkBkD,IAClB6B,EAAS7B,GAASO,EAC9B,CACQG,GAAiC,mBAAjBA,EAAW,KAC3BlB,OAAOmH,uBAAsB,IAAMjG,EAAW,IAAEH,IAExD,CA+BA,SAAS2B,EAAgBS,EAAMV,EAAQ2E,EAAM,GACzC,IAAIvD,EACJ,GAAoB,iBAATV,EACP,OAAOA,EACX,GAAItC,MAAMC,QAAQqC,GACd,OAAOA,EAAKlE,KAAIoF,GAAS3B,EAAgB2B,EAAO5B,EAAQ2E,OAC5D,IAAIxG,EAAOuC,EAIX,GAHIA,GAA4B,mBAAbA,EAAKlC,KAAsB1C,OAAO8I,eAAelE,EAAKlC,KAAKqG,IAC1E1G,EAtCR,SAA0BuC,EAAMV,EAAQ2E,GACpC,MAAMnG,IAAEA,EAAGC,MAAEA,EAAKC,SAAEA,GAAagC,EACjC,IAAI/B,EAAM,IAAIgG,IACVG,EAAKrG,GAASA,EAAU,GACvBqG,EAGDnG,EAAMmG,EAFNA,EAAK,IAAIH,IAAMI,KAAKC,QAGxB,IAAIC,EAAQ,UACRxG,GAASA,EAAU,KACnBwG,EAAQxG,EAAU,UACXA,EAAU,IAEhBuB,EAAOkF,IACRlF,EAAOkF,EAAmB,CAAE,GAChC,IAAIrH,EAAYmC,EAAOkF,EAAiBvG,GACxC,GAAKd,GAAeA,aAAqBW,GAASX,EAAUS,QAKxDT,EAAUsH,YAAYtH,EAAUG,WALiC,CACjE,MAAMM,EAAUgC,SAAS0C,cAAciC,GACvCpH,EAAYmC,EAAOkF,EAAiBvG,GAAO,IAAIH,EAAI1C,OAAOI,OAAOJ,OAAOI,OAAO,CAAE,EAAEuC,GAAQ,CAAEC,cAAa0G,MAAM9G,EAAS,CAAE+B,QAAQ,GAC3I,CAII,GAAIxC,EAAUwH,QAAS,CACnB,MAAMC,EAAYzH,EAAUwH,QAAQ5G,EAAOC,EAAUb,EAAUG,YACzC,IAAdsH,GAA8BzH,EAAUI,SAASqH,EACjE,CAEI,OADAnE,EAAYtD,EAAUS,QAASG,GAAO,GAC/BZ,EAAUS,OACrB,CASeiH,CAAiB7E,EAAMV,EAAQ2E,IAEtCxG,GAAQC,MAAMC,QAAQF,EAAKO,UAAW,CACtC,MAAM8G,EAAmC,QAArBpE,EAAKjD,EAAKM,aAA0B,IAAP2C,OAAgB,EAASA,EAAGqE,WAC7E,GAAID,EAAY,CACZ,IAAI7F,EAAI,EACRxB,EAAKO,SAAWP,EAAKO,SAASlC,KAAIoF,GAAS3B,EAAgB2B,EAAO4D,EAAY7F,MAC1F,MAEYxB,EAAKO,SAAWP,EAAKO,SAASlC,KAAIoF,GAAS3B,EAAgB2B,EAAO5B,EAAQ2E,MAEtF,CACI,OAAOxG,CACX,CChRO,MAAMuH,EAAgB,CAACC,EAAgB5K,EAAU,CAAA,IAAO,cAA4BkH,YACvF,WAAAxH,GACImL,OACR,CACI,aAAI/H,GAAc,OAAOnD,KAAK+K,UAAW,CACzC,SAAIzH,GAAU,OAAOtD,KAAK+K,WAAWzH,KAAM,CAC3C,6BAAW6H,GAEP,OAAQ9K,EAAQ8K,oBAAsB,IAAIrJ,KAAIsJ,GAAQA,EAAK3B,eACnE,CACI,iBAAA4B,GACI,GAAIrL,KAAKsL,cAAgBtL,KAAK+K,WAAY,CACtC,MAAMQ,EAAOlL,GAAW,CAAE,EAC1BL,KAAKwL,YAAcD,EAAKE,OAASzL,KAAK0L,aAAa,CAAEC,KAAM,SAAY3L,KACvE,MAAMmL,EAAsBI,EAAKJ,oBAAsB,GACjDS,EAAUT,EAAmBU,QAAO,CAAC/J,EAAK3B,KAC5C,MAAM2L,EAAK3L,EAAKsJ,cAIhB,OAHIqC,IAAO3L,IACP2B,EAAIgK,GAAM3L,GAEP2B,CAAG,GACX,IACH9B,KAAK+L,SAAY5L,GAASyL,EAAQzL,IAASA,EAC3C,MAAM4D,EAAQ,CAAE,EAChBL,MAAM8E,KAAKxI,KAAKgM,YAAY9K,SAAQ+K,GAAQlI,EAAM/D,KAAK+L,SAASE,EAAK9L,OAAS8L,EAAK5I,QAEnF8H,EAAmBjK,SAAQf,SACJ+L,IAAflM,KAAKG,KACL4D,EAAM5D,GAAQH,KAAKG,IACvBiB,OAAO+K,eAAenM,KAAMG,EAAM,CAC9BiM,IAAG,IACQrI,EAAM5D,GAEjB,GAAAkM,CAAIhJ,GAEArD,KAAKsM,yBAAyBnM,EAAM4D,EAAM5D,GAAOkD,EACpD,EACDkJ,cAAc,EACdC,YAAY,GACd,IAENxC,uBAAsB,KAClB,MAAMhG,EAAWhE,KAAKgE,SAAWN,MAAM8E,KAAKxI,KAAKgE,UAAY,GAO7D,GALAhE,KAAK+K,WAAa,IAAIE,EAAe7J,OAAOI,OAAOJ,OAAOI,OAAO,CAAA,EAAIuC,GAAQ,CAAEC,cAAa0G,MAAM1K,KAAKwL,YAAaD,GAEpHvL,KAAK+K,WAAW0B,OAAS1I,EAEzB/D,KAAK+K,WAAW2B,cAAgB1M,KAAK0M,cAAcC,KAAK3M,MACpDA,KAAK+K,WAAWJ,QAAS,CACzB,MAAMC,EAAY5K,KAAK+K,WAAWJ,QAAQ5G,EAAOC,EAAUhE,KAAK+K,WAAWzH,YAClD,IAAdsH,IACP5K,KAAK+K,WAAWzH,MAAQsH,EAChD,CACgB5K,KAAKE,GAAKF,KAAK+K,WAAW7K,GAAGyM,KAAK3M,KAAK+K,YACvC/K,KAAKY,IAAMZ,KAAK+K,WAAWnK,IAAI+L,KAAK3M,KAAK+K,aACnB,IAAhBQ,EAAK5F,QACP3F,KAAK+K,WAAWnK,IAAI,IAAI,GAE5C,CACA,CACI,oBAAAgM,GACI,IAAIlG,EAAIC,EAAIkG,EAAIC,EACiE,QAAhFnG,EAAgC,QAA1BD,EAAK1G,KAAK+K,kBAA+B,IAAPrE,OAAgB,EAASA,EAAGqG,cAA2B,IAAPpG,GAAyBA,EAAGqG,KAAKtG,GACxC,QAAjFoG,EAAgC,QAA1BD,EAAK7M,KAAK+K,kBAA+B,IAAP8B,OAAgB,EAASA,EAAGI,eAA4B,IAAPH,GAAyBA,EAAGE,KAAKH,GAC3H7M,KAAK+K,WAAa,IAC1B,CACI,wBAAAuB,CAAyBnM,EAAM+M,EAAU7J,GACrC,GAAIrD,KAAK+K,WAAY,CAEjB,MAAMoC,EAAanN,KAAK+L,SAAS5L,GAEjCH,KAAK+K,WAAW0B,OAAOU,GAAc9J,EACrCrD,KAAK+K,WAAWnK,IAAI,mBAAoBuM,EAAYD,EAAU7J,GAC1DA,IAAU6J,IAAiC,IAAnB7M,EAAQsF,QAChC9C,OAAOmH,uBAAsB,KAEzBhK,KAAK+K,WAAWnK,IAAI,IAAI,GAG5C,CACA,GAEA,IAAAwM,EAAe,CAACjN,EAAM8K,EAAgB5K,KACP,oBAAnBgN,gBAAmCA,eAAeC,OAAOnN,EAAM6K,EAAcC,EAAgB5K,GAAS,ECjF3G,MAAMkN,EAAU,CACnBC,KAAM,IAAIrI,QACV,cAAAsI,CAAeC,EAAaC,EAAerJ,GAClCtE,KAAKwN,KAAKI,IAAItJ,IACftE,KAAKwN,KAAKnB,IAAI/H,EAAQ,CAAA,GAC1BtE,KAAKwN,KAAKpB,IAAI9H,GAAQoJ,GAAeC,CACxC,EACD,eAAAE,CAAgBvJ,GAEZ,OADAA,EAASlD,OAAO8I,eAAe5F,GACxBtE,KAAKwN,KAAKpB,IAAI9H,GAAUlD,OAAOC,KAAKrB,KAAKwN,KAAKpB,IAAI9H,IAAW,EACvE,EACD,WAAAwJ,CAAYJ,EAAapJ,GAErB,OADAA,EAASlD,OAAO8I,eAAe5F,GACxBtE,KAAKwN,KAAKpB,IAAI9H,GAAUtE,KAAKwN,KAAKpB,IAAI9H,GAAQoJ,GAAe,IAC5E,GAEO,SAAS3H,EAAO7D,EAAQ7B,EAAU,IACrC,MAAO,CAACiE,EAAQL,EAAK8J,KACjB,MAAM5N,EAAO+B,EAASA,EAAO8L,WAAa/J,EAE1C,OADAsJ,EAAQE,eAAe,iBAAiBtN,IAAQ,CAAEA,OAAM8D,MAAK5D,WAAWiE,GACjEyJ,CAAU,CAEzB,CACO,SAAS7N,EAAGgC,EAAQ7B,EAAU,IACjC,OAAO,SAAUiE,EAAQL,GACrB,MAAM9D,EAAO+B,EAASA,EAAO8L,WAAa/J,EAC1CsJ,EAAQE,eAAe,iBAAiBtN,IAAQ,CAAEA,OAAM8D,MAAK5D,WAAWiE,EAC3E,CACL,CACO,SAAS0G,EAAc7K,EAAME,GAChC,OAAO,SAAwBN,GAE3B,OADAqN,EAAajN,EAAMJ,EAAaM,GACzBN,CACV,CACL,CCjCA,MAAMkO,EAAiB,IAAIC,IACtBlL,EAAIrC,KAAK,mBACVqC,EAAI9C,GAAG,kBAAkBiO,GAAKA,EAAEC,WAAaH,IACjD,MAAMI,EAAU/K,GAASA,EAClB,MAAMgL,EACT,WAAA7D,CAAYnH,EAAOG,EAAO,MACtB,IAAKzD,KAAKuO,KACN,OACJ,IAAInG,EAAO3E,GAAQzD,KAAKuO,KAAKjL,GAQ7B,GAPAN,EAAW,OAAKA,EAAIpC,IAAI,QAAS,CAC7BuC,UAAWnD,KACXwO,EAAGpG,EAAO,IAAM,IAChB9E,QACAG,KAAM2E,EACNnC,GAAIjG,KAAK4D,UAEW,iBAAbgC,SACP,OACJ,MAAMK,EAA8B,iBAAjBjG,KAAK4D,SAAwB5D,KAAK4D,QACjDgC,SAASC,eAAe7F,KAAK4D,UAAYgC,SAASE,cAAc9F,KAAK4D,SAAW5D,KAAK4D,QACzF,IAAKqC,EACD,OACJ,MAAMwI,EAAgB,KACjBzO,KAAK+M,OAGD9G,EAAe,aAAMjG,MAAQiG,EAAG8D,aAAa0E,KAAmBzO,KAAK0O,cAC1E1O,KAAK0O,aAAc,IAAIrE,MAAOsE,UAAUX,WACxC/H,EAAG2D,aAAa6E,EAAezO,KAAK0O,aACJ,oBAArBE,mBACF5O,KAAK6O,WACN7O,KAAK6O,SAAW,IAAID,kBAAiBE,IAC7BA,EAAQ,GAAG5B,WAAalN,KAAK0O,aAAgB9I,SAASmJ,KAAKC,SAAS/I,KACpEjG,KAAK+M,OAAO/M,KAAKsD,OACjBtD,KAAK6O,SAASI,aACdjP,KAAK6O,SAAW,KAC5C,KAEgB7O,KAAK6O,SAASK,QAAQtJ,SAASmJ,KAAM,CACjCI,WAAW,EAAMC,SAAS,EAC1BpD,YAAY,EAAMqD,mBAAmB,EAAMC,gBAAiB,CAACb,OAhBrExI,EAAG4D,iBAAmB5D,EAAG4D,gBAAgB4E,GAoB7CxI,EAAe,WAAIjG,MACdyD,GAAQ2E,IACTA,EAAO5E,EAAU4E,EAAMpI,MACnBA,KAAKK,QAAQkP,YAAc3J,UAAYA,SAA8B,oBACrEA,SAA8B,qBAAE,IAAM5C,EAAI2C,OAAOM,EAAImC,EAAMpI,QAG3DgD,EAAI2C,OAAOM,EAAImC,EAAMpI,OAG7BA,KAAKwP,UAAYxP,KAAKwP,SAASxP,KAAKsD,MAC5C,CACI,QAAAC,CAASD,EAAOjD,EAAU,CAAEsF,QAAQ,EAAM8J,SAAS,IAC/C,MAAMC,EAAsBC,MAAOC,IAC/B,IACI,OAAa,CACT,MAAMvM,MAAEA,EAAKwM,KAAEA,SAAeD,EAASE,OACvC,GAAID,EACA,MACJ7P,KAAKuD,SAASF,EAAOhD,EACzC,CACA,CACY,MAAO8D,GACHpD,QAAQgP,MAAM,2BAA4B5L,EAC1D,GAEc6L,EAAS1M,EACf,GAAI0M,aAAuC,EAASA,EAAOC,OAAOC,eAE9DlQ,KAAKuD,SAASmM,EAAoBM,EAAOC,OAAOC,kBAAmB7P,QAGlE,IAAK2P,aAAuC,EAASA,EAAOC,OAAOL,YAAqC,mBAAhBI,EAAOF,KAChG,IAAK,MAAMzM,KAAS2M,EAChBhQ,KAAKuD,SAASF,EAAOhD,QAIxB,GAAIiD,GAASA,aAAiBvB,QAG/BA,QAAQoO,QAAQ7M,GAAO8M,MAAKC,IACxBrQ,KAAKuD,SAAS8M,EAAGhQ,GACjBL,KAAKsQ,OAAShN,CAAK,QAGtB,CAED,GADAtD,KAAKsQ,OAAShN,EACD,MAATA,EACA,OACJtD,KAAKsD,MAAQA,GACU,IAAnBjD,EAAQsF,SAEJtF,EAAQkP,YAAc3J,UAAYA,SAA8B,oBAChEA,SAA8B,qBAAE,IAAM5F,KAAKyK,YAAYnH,KAGvDtD,KAAKyK,YAAYnH,KAGD,IAApBjD,EAAQoP,SAAqBzP,KAAKuQ,iBAClCvQ,KAAKwQ,SAAW,IAAIxQ,KAAKwQ,SAAUlN,GACnCtD,KAAKyQ,aAAezQ,KAAKwQ,SAASvP,OAAS,GAEf,mBAArBZ,EAAQqQ,UACfrQ,EAAQqQ,SAAS1Q,KAAKsD,MACtC,CACA,CACI,WAAAvD,CAAYuD,EAAOiL,EAAMxI,EAAQ1F,GAC7BL,KAAKsD,MAAQA,EACbtD,KAAKuO,KAAOA,EACZvO,KAAK+F,OAASA,EACd/F,KAAKK,QAAUA,EACfL,KAAK2C,KAAO,IAAI7C,EAChBE,KAAK2Q,SAAW,GAChB3Q,KAAK4Q,eAAiB,GACtB5Q,KAAKwQ,SAAW,GAChBxQ,KAAKyQ,cAAgB,EACrBzQ,KAAK6Q,cAAgB,KACjB7Q,KAAKyQ,eACDzQ,KAAKyQ,cAAgB,EACrBzQ,KAAKuD,SAASvD,KAAKwQ,SAASxQ,KAAKyQ,cAAe,CAAE9K,QAAQ,EAAM8J,SAAS,IAGzEzP,KAAKyQ,aAAe,CACpC,EAEQzQ,KAAK8Q,cAAgB,KACjB9Q,KAAKyQ,eACDzQ,KAAKyQ,aAAezQ,KAAKwQ,SAASvP,OAClCjB,KAAKuD,SAASvD,KAAKwQ,SAASxQ,KAAKyQ,cAAe,CAAE9K,QAAQ,EAAM8J,SAAS,IAGzEzP,KAAKyQ,aAAezQ,KAAKwQ,SAASvP,OAAS,CAC3D,EAEQjB,KAAK+Q,MAAQ,CAACnN,EAAU,KAAMvD,KAE1B,GADAL,KAAK0K,MAAM9G,EAASxC,OAAOI,OAAO,CAAEmE,QAAQ,GAAQtF,IAChDL,KAAK2K,SAAmC,mBAAjB3K,KAAK2K,QAAwB,CACpD,MAAMC,EAAY5K,KAAK2K,QAAQ,CAAE,EAAE,GAAI3K,KAAKsD,YACtB,IAAdsH,GAA8B5K,KAAKuD,SAASqH,EACpE,CACY,OAAO5K,IAAI,CAEvB,CACI,KAAA0K,CAAM9G,EAAU,KAAMvD,GAClB,IAAIqG,EAAIC,EA4BR,OA3BA5F,QAAQC,QAAQhB,KAAK4D,QAAS,8BAC9B5D,KAAKK,QAAUA,EAAUe,OAAOI,OAAOJ,OAAOI,OAAO,GAAIxB,KAAKK,SAAUA,GACxEL,KAAK4D,QAAUA,EACf5D,KAAKgR,aAAe3Q,EAAQ2Q,aAC5BhR,KAAKuQ,iBAAmBlQ,EAAQoP,QAC5BzP,KAAKuQ,iBACLvQ,KAAKE,GAAGG,EAAQoP,QAAQwB,MAAQ,eAAgBjR,KAAK6Q,eACrD7Q,KAAKE,GAAGG,EAAQoP,QAAQK,MAAQ,eAAgB9P,KAAK8Q,gBAErDzQ,EAAQ6Q,QACRlR,KAAK+F,OAAS/F,KAAK+F,QAAU,CAAE,EAC1B/F,KAAK+F,OAAO1F,EAAQ6Q,SACrBlR,KAAK+F,OAAO1F,EAAQ6Q,OAAS7C,IAErCrO,KAAKmR,cACLnR,KAAKsD,MAAoF,QAA3EqD,EAA2B,QAArBD,EAAK1G,KAAKsD,aAA0B,IAAPoD,EAAgBA,EAAK1G,KAAY,aAAsB,IAAP2G,EAAgBA,EAAK,CAAE,EAC9F,mBAAf3G,KAAKsD,QACZtD,KAAKsD,MAAQtD,KAAKsD,SACtBtD,KAAKuD,SAASvD,KAAKsD,MAAO,CAAEqC,SAAUtF,EAAQsF,OAAQ8J,SAAS,IAC3DzM,EAAW,QACPiL,EAAe7B,IAAIxI,GACnBqK,EAAe7B,IAAIxI,GAAStD,KAAKN,MAGjCiO,EAAe5B,IAAIzI,EAAS,CAAC5D,QAG9BA,IACf,CACI,eAAAoR,CAAgBjR,GACZ,OAAOA,IAASH,KAAKgR,cACjBhR,KAAK4Q,eAAenI,QAAQtI,IAAS,GACrCA,EAAKkC,WAAW,MAAQlC,EAAKkC,WAAW,MAAQlC,EAAKkC,WAAW,KAC5E,CACI,UAAAgP,CAAWlR,EAAMmR,EAAQjR,EAAU,CAAA,GAC1BiR,GAA4B,mBAAXA,IAElBjR,EAAQyC,QACR9C,KAAK4Q,eAAetQ,KAAKH,GAC7BH,KAAKE,GAAGC,GAAM,IAAIkE,KACdrB,EAAW,OAAKA,EAAIpC,IAAI,QAAS,CAC7BuC,UAAWnD,KACXwO,EAAG,IACH9L,MAAOvC,EAAMkE,IACbkN,cAAevR,KAAKsD,MACpBjD,YAEJ,MAAMmR,EAAWF,EAAOtR,KAAKsD,SAAUe,GACvCrB,EAAW,OAAKA,EAAIpC,IAAI,QAAS,CAC7BuC,UAAWnD,KACXwO,EAAG,IACH9L,MAAOvC,EAAMkE,IACbmN,WACAlO,MAAOtD,KAAKsD,MACZjD,YAEJL,KAAKuD,SAASiO,EAAUnR,EAAQ,GACjCA,GACX,CACI,WAAA8Q,GACI,MAAMM,EAAUzR,KAAK+F,QAAU,CAAE,EACjCwH,EAAQM,gBAAgB7N,MAAMkB,SAAQ+C,IAClC,GAAIA,EAAI5B,WAAW,kBAAmB,CAClC,MAAMmL,EAAOD,EAAQO,YAAY7J,EAAKjE,MACtCyR,EAAQjE,EAAKrN,MAAQ,CAACH,KAAKwN,EAAKvJ,KAAK0I,KAAK3M,MAAOwN,EAAKnN,QACtE,KAEQ,MAAM2B,EAAM,CAAE,EACV0B,MAAMC,QAAQ8N,GACdA,EAAQvQ,SAAQwQ,IACZ,MAAOvR,EAAMmR,EAAQ/F,GAAQmG,EACfvR,EAAK6N,WACb2D,MAAM,KAAKzQ,SAAQ4G,GAAK9F,EAAI8F,EAAE8J,QAAU,CAACN,EAAQ/F,IAAM,IAIjEnK,OAAOC,KAAKoQ,GAASvQ,SAAQf,IACzB,MAAMmR,EAASG,EAAQtR,IACD,mBAAXmR,GAAyB5N,MAAMC,QAAQ2N,KAC9CnR,EAAKwR,MAAM,KAAKzQ,SAAQ4G,GAAK9F,EAAI8F,EAAE8J,QAAUN,GACjE,IAGatP,EAAI,OACLA,EAAI,KAAOqM,GACfjN,OAAOC,KAAKW,GAAKd,SAAQf,IACrB,MAAMmR,EAAStP,EAAI7B,GACG,mBAAXmR,EACPtR,KAAKqR,WAAWlR,EAAMmR,GAEjB5N,MAAMC,QAAQ2N,IACnBtR,KAAKqR,WAAWlR,EAAMmR,EAAO,GAAIA,EAAO,GACxD,GAEA,CACI,GAAA1Q,CAAI8B,KAAU7B,GACV,GAAIb,KAAKsD,iBAAiBvB,QACtB,OAAOA,QAAQoO,QAAQnQ,KAAKsD,OAAO8M,MAAK9M,IACpCtD,KAAKsD,MAAQA,EACbtD,KAAKY,IAAI8B,KAAU7B,EAAK,IAG3B,CACD,MAAMV,EAAOuC,EAAMsL,WACnB,OAAOhO,KAAKoR,gBAAgBjR,GACxB6C,EAAIpC,IAAIT,KAASU,GACjBb,KAAK2C,KAAK/B,IAAIT,KAASU,EACvC,CACA,CACI,EAAAX,CAAGwC,EAAOtC,EAAIC,GACV,MAAMF,EAAOuC,EAAMsL,WAEnB,OADAhO,KAAK2Q,SAASrQ,KAAK,CAAEH,OAAMC,OACpBJ,KAAKoR,gBAAgBjR,GACxB6C,EAAI9C,GAAGC,EAAMC,EAAIC,GACjBL,KAAK2C,KAAKzC,GAAGC,EAAMC,EAAIC,EACnC,CACI,QAAAuB,CAASc,KAAU7B,GACf,MAAMV,EAAOuC,EAAMsL,WACnB,OAAOhO,KAAKoR,gBAAgBjR,GACxB6C,EAAIpB,SAASzB,KAASU,GACtBb,KAAK2C,KAAKf,SAASzB,KAASU,EACxC,CAEI,KAAAoB,CAAMS,KAAU7B,GACZ,OAAOb,KAAK4B,SAASc,KAAU7B,EACvC,CACI,OAAAoM,GACI,IAAIvG,EACqB,QAAxBA,EAAK1G,KAAK6O,gBAA6B,IAAPnI,GAAyBA,EAAGuI,aAC7DjP,KAAK2Q,SAASzP,SAAQoQ,IAClB,MAAMnR,KAAEA,EAAIC,GAAEA,GAAOkR,EACrBtR,KAAKoR,gBAAgBjR,GACjB6C,EAAIzC,IAAIJ,EAAMC,GACdJ,KAAK2C,KAAKpC,IAAIJ,EAAMC,EAAG,GAEvC,EAEAkO,EAAUnE,GAAsB,EC3SpB,MAAC0H,EAAe,KACfC,EAAmB,MACnBZ,EAASa,IAClB,GAAI/O,EAAa,UAAM+O,EAKvB,GAHA/O,EAAa,QAAI+O,EACZA,IACDA,EAAM,KACNA,EAAI1P,WAAW,KAAM,CACrB,MAAOlC,KAAS6R,GAAQD,EAAIJ,MAAM,KAClC3O,EAAIpC,IAAIT,KAAS6R,IAAShP,EAAIpC,IAAIkR,EAAkB3R,KAAS6R,GAC7DhP,EAAIpC,IAAIiR,EAAc1R,KAAS6R,EACvC,MACS,GAAID,EAAI1P,WAAW,KAAM,CAC1B,MAAOmM,EAAGrO,KAAS6R,GAAQD,EAAIJ,MAAM,KACrC3O,EAAIpC,IAAI,IAAMT,KAAS6R,IAAShP,EAAIpC,IAAIkR,EAAkB,IAAM3R,KAAS6R,GACzEhP,EAAIpC,IAAIiR,EAAc,IAAM1R,KAAS6R,EAC7C,MAEQhP,EAAIpC,IAAImR,IAAQ/O,EAAIpC,IAAIkR,EAAkBC,GAC1C/O,EAAIpC,IAAIiR,EAAcE,EAC9B,ECFA,IAAK/O,EAAI+N,MAAO,CACZ/N,EAAIiP,QAAU,SACdjP,EAAIkP,EAAIlP,EAAIsF,cLxBT,SAAuBxE,EAAKC,KAAUC,GACzC,MAAMe,EAAKF,EAAQb,GACnB,GAAmB,iBAARF,EACP,MAAO,CAAEA,MAAKC,QAAOC,SAAUe,GAC9B,GAAIrB,MAAMC,QAAQG,GACnB,OAAOA,EACN,QAAYoI,IAARpI,GAAqBE,EAC1B,OAAOe,EACN,GAAI3D,OAAO8I,eAAepG,GAAKqG,EAChC,MAAO,CAAErG,MAAKC,QAAOC,SAAUe,GAC9B,GAAmB,mBAARjB,EACZ,OAAOA,EAAIC,EAAOgB,GAElB,MAAM,IAAIoN,MAAM,uBAAuBrO,IAC/C,EKWId,EAAI2C,OAASA,EACb3C,EAAI4B,SAAWA,EACf5B,EAAIoK,aAAeA,EACnBpK,EAAImF,SAAWA,EACfnF,EAAI+N,MAAQ,CAACnN,EAASwO,EAAO7D,EAAMxI,EAAQ1F,KACvC,MAAMkL,EAAOnK,OAAOI,OAAO,CAAEmE,QAAQ,EAAMqL,cAAc,GAAQ3Q,GAC3D8C,EAAY,IAAImL,EAAU8D,EAAO7D,EAAMxI,GAM7C,OALI1F,GAAWA,EAAQmP,WACnBrM,EAAUqM,SAAWnP,EAAQmP,UAC7BnP,GAAWA,EAAQsK,UACnBxH,EAAUwH,QAAUtK,EAAQsK,SAChCxH,EAAU4N,MAAMnN,EAAS2H,GAClBpI,CAAS,EAEpB,MAAMkP,EAAO7D,MAEbxL,EAAI9C,GAAG,SAASsO,GAAK6D,IACrBrP,EAAI9C,GAAG2R,EAAcQ,GACrBrP,EAAI9C,GAAG4R,EAAkBO,GACzBrP,EAAIkO,MAAQA,EACZlO,EAAI9C,GAAG,SAAS6R,GAAO/O,EAAW,OAAKA,EAAW,MAAE+O,KAC5B,iBAAbnM,UACPA,SAAS0M,iBAAiB,oBAAoB,KAC1C,MAAMC,EAAY3M,SAASmJ,KAAKyD,aAAa,mBAAqBxP,EAAI,mBAAoB,EACpFyP,EAAWzP,EAAIrC,KAAK,MAAQqC,EAAIrC,KAAK,QAAS,EAEpDkC,OAAOyP,iBAAiB,cAAc,IAAMpB,EAAMwB,SAASC,QAC3D9P,OAAOyP,iBAAiB,YAAY,IAAMpB,EAAMwB,SAASE,YACrDH,EACAF,GAAarB,EAAMwB,SAASC,OAG5BJ,GAAarB,EAAMwB,SAASE,UAC5BhN,SAASmJ,KAAKuD,iBAAiB,SAASnO,IACpC,MAAMP,EAAUO,EAAEG,OACZuO,EAA4B,MAApBjP,EAAQkP,QAAkBlP,EAAUA,EAAQmP,QAAQ,KAC9DF,GACAA,EAAKG,SAAWN,SAASM,SACzB7O,EAAE8O,iBACFxD,QAAQyD,UAAU,KAAM,GAAIL,EAAKD,UACjC1B,EAAM2B,EAAKD,UACnC,IAEA,IAG0B,iBAAX/P,SACPA,OAAkB,UAAIyL,EACtBzL,OAAe,OAAIA,OAAc,MACjCA,OAAc,MAAIG,EAClBH,OAAW,GAAI3C,EACf2C,OAAsB,cAAImI,EAC1BnI,OAAiB,SAAIsF,GAEzBnF,EAAImQ,WAAa,CAACxN,EAAQgG,EAAO,KAEzB3I,EAAI2C,OADK,IAATgG,EACa,CAAC1F,EAAIxC,IAASkC,EAAOlC,EAAMwC,GAG3B,CAACA,EAAIxC,IAASkC,EAAOM,EAAIxC,EAClD,EAEIT,EAAIoQ,UAAY,CAACC,EAAOC,KACpBtQ,EAAIkP,EAAIlP,EAAIsF,cAAgB+K,EAAM/K,cAClCtF,EAAI4B,SAAWyO,EAAMzO,SACrB5B,EAAI2C,OAAS,CAACM,EAAIxC,IAAS6P,EAAS3N,OAAOlC,EAAMwC,GAC7CoN,EAAMpB,SAAWoB,EAAMpB,QAAQ5P,WAAW,QAC1CW,EAAI2C,OAAS,CAACM,EAAIxC,KACTwC,GAAOxC,IAEPwC,EAAGsN,QACJtN,EAAGsN,MAAQD,EAASE,WAAWvN,IACnCA,EAAGsN,MAAM5N,OAAOlC,GAAK,EAErC,CAEA"}